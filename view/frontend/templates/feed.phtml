<?php
/**
 * Instagram Feed Template - Redline Boutique
 * Layout identique à la production
 * 
 * @var \ElielWeb\InstagramFeed\Block\Feed $block
 */

$posts = $block->getPosts();
$username = $block->getUsername();
$instagramUrl = "https://www.instagram.com/" . $username . "/";

if (empty($posts)) {
    return;
}
?>

<div class="instagram-feed">
    <!-- Titre @redline_paris aligné à gauche -->
    <div class="instagram-title">
        <h2>@<?= $block->escapeHtml($username) ?></h2>
    </div>
    
    <!-- Grille d'images -->
    <ul class="list overflow__content clearfix">
        <?php foreach (array_slice($posts, 0, 5) as $index => $post): ?>
            <?php
            // URL de l'image (vidéo = thumbnail, sinon media_url)
            $imageUrl = '';
            if (isset($post['media_type']) && $post['media_type'] === 'VIDEO') {
                $imageUrl = $post['thumbnail_url'] ?? '';
            } else {
                $imageUrl = $post['media_url'] ?? '';
            }
            
            // Skip si pas d'image
            if (empty($imageUrl)) {
                continue;
            }
            
            // URL du post Instagram
            $postUrl = $post['permalink'] ?? $instagramUrl;
            $caption = $post['caption'] ?? '';
            ?>
            
            <li class="instagram__item item--<?= $index ?>">
                <a href="<?= $block->escapeUrl($postUrl) ?>" 
                   target="_blank" 
                   rel="noopener noreferrer"
                   title="<?= $block->escapeHtmlAttr($caption ?: 'View on Instagram') ?>">
                    <div class="js-image-cover-wrapper has-hover--border">
                        <img class="js-image-cover" 
                             src="<?= $block->escapeUrl($imageUrl) ?>" 
                             alt="<?= $block->escapeHtmlAttr($username) ?> - Instagram photo <?= $index + 1 ?>"
                             loading="lazy" />
                    </div>
                </a>
            </li>
            
        <?php endforeach; ?>
    </ul>
</div>
